# Домашнее задание 2

### Учетная запись
Создал файл create_user.sql рядом с миграциями, его надо запускать отдельно после создания таблиц. Теперь конечный пользователь имеет право на добавление, изменение и удаление данных внутри таблиц базы, потому что он может создать, удалять и изменять письма.
### Защита от SQL-Injections

### Пул соединений и параметры соединений
В файле конфига базы данных docker/postgres/db.conf мы прописали максимальное количество открытых соединений, равное 10  
``
    max_connections = 10
``  
И прописали адреса, которые будет прослушивать бд  
``
    listen_addresses = 'localhost,89.208.228.234'
``  

Также в функции инициализации соединения с бд service/postgres/init.go были установлены максимальное количество открытых подключений и подключений в пуле  
``
    db.SetMaxOpenConns(10)  
``  
``
	db.SetMaxIdleConns(10)  
``  
Выбрали такое значение (10), поскольку наше приложение не подвергается высокой нагрузке.

### Таймауты
Мы установили таймауты для соединений и запросов.

`statement_timeout = 30s`

Выбор значения в 30 секунд обоснован следующими факторами:
- Бизнес-требования почтового сервиса:
  1. Основные операции (отправка/получение писем) должны быть быстрыми
  2. Сложные поисковые запросы не должны превышать 30 секунд
  3. Работа с вложениями оптимизирована
- Безопасность:
  1. Маленький таймаут не позволяет пользователю зависнуть на странице
  2. Защита от DOS-атак
- Производительность системы:
  1. Предотвращение длительной блокировки ресурсов БД
  2. Оптимизация connection pool
  3. Равномерное распределение нагрузки между пользователями

`lock_timeout = 10s`

Выбор значения в 10 секунд обоснован следующими факторами:
  1. Быстрое обнаружение deadlocks
  2. Предотвращение каскадных блокировок
  3. Оптимальный баланс между:
     - Временем ожидания освобождения ресурса
     - Вероятностью успешного завершения транзакции
  4. Защита от:
     - Взаимных блокировок - deadlocks
     - Бесконечного ожидания - livelock
     - Истощения пула соединений

### Логгирование и протоколирование медленных запросов

